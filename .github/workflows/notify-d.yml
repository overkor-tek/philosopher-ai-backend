name: Notify D of Repository Activity

on:
  issues:
    types: [opened, closed, reopened]
  pull_request:
    types: [opened, closed, reopened, merged]
  release:
    types: [published, created]
  discussion:
    types: [created, answered]
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install nodemailer

      - name: Send notification email
        env:
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
          RECIPIENT_EMAIL: ${{ secrets.RECIPIENT_EMAIL }}
        run: |
          node -e "
          const nodemailer = require('nodemailer');

          const transporter = nodemailer.createTransport({
            service: 'gmail',
            auth: {
              user: process.env.EMAIL_USER,
              pass: process.env.EMAIL_PASS
            }
          });

          const eventName = '${{ github.event_name }}';
          const repo = '${{ github.repository }}';
          const actor = '${{ github.actor }}';
          const discussionUrl = '${{ github.event.discussion.html_url }}';

          let subject = '';
          let message = '';

          if (eventName === 'issues') {
            const issueTitle = '${{ github.event.issue.title }}';
            const issueUrl = '${{ github.event.issue.html_url }}';
            const action = '${{ github.event.action }}';

            subject = \`ðŸŒ¸ Issue \${action} in \${repo}\`;
            message = \`
              <h2>Issue \${action.charAt(0).toUpperCase() + action.slice(1)} in \${repo}</h2>
              <p><strong>Issue:</strong> \${issueTitle}</p>
              <p><strong>By:</strong> \${actor}</p>
              <p><a href=\"\${issueUrl}\" style=\"background:#FF69B4;color:#fff;padding:10px 20px;text-decoration:none;\">View Issue</a></p>
              <hr>
              <p style=\"color:#666;\">Part of The Pink Revolution ðŸ’–</p>
            \`;
          } else if (eventName === 'pull_request') {
            const prTitle = '${{ github.event.pull_request.title }}';
            const prUrl = '${{ github.event.pull_request.html_url }}';
            const action = '${{ github.event.action }}';

            subject = \`ðŸŒ¸ Pull Request \${action} in \${repo}\`;
            message = \`
              <h2>Pull Request \${action.charAt(0).toUpperCase() + action.slice(1)} in \${repo}</h2>
              <p><strong>PR:</strong> \${prTitle}</p>
              <p><strong>By:</strong> \${actor}</p>
              <p><a href=\"\${prUrl}\" style=\"background:#FF69B4;color:#fff;padding:10px 20px;text-decoration:none;\">View Pull Request</a></p>
              <hr>
              <p style=\"color:#666;\">Part of The Pink Revolution ðŸ’–</p>
            \`;
          } else if (eventName === 'release') {
            const releaseName = '${{ github.event.release.name }}';
            const releaseUrl = '${{ github.event.release.html_url }}';

            subject = \`ðŸŒ¸ New Release in \${repo}\`;
            message = \`
              <h2>New Release in \${repo}</h2>
              <p><strong>Release:</strong> \${releaseName}</p>
              <p><strong>By:</strong> \${actor}</p>
              <p><a href=\"\${releaseUrl}\" style=\"background:#FF69B4;color:#fff;padding:10px 20px;text-decoration:none;\">View Release</a></p>
              <hr>
              <p style=\"color:#666;\">Part of The Pink Revolution ðŸ’–</p>
            \`;
          } else if (eventName === 'discussion') {
            const discussionTitle = '${{ github.event.discussion.title }}';

            subject = \`ðŸŒ¸ New Discussion in \${repo}\`;
            message = \`
              <h2>New Discussion in \${repo}</h2>
              <p><strong>Discussion:</strong> \${discussionTitle}</p>
              <p><strong>By:</strong> \${actor}</p>
              <p><a href=\"\${discussionUrl}\" style=\"background:#FF69B4;color:#fff;padding:10px 20px;text-decoration:none;\">View Discussion</a></p>
              <hr>
              <p style=\"color:#666;\">Part of The Pink Revolution ðŸ’–</p>
            \`;
          } else if (eventName === 'push') {
            const commitMessage = '${{ github.event.head_commit.message }}';
            const commitUrl = '${{ github.event.head_commit.url }}';
            const branch = '${{ github.ref_name }}';

            subject = \`ðŸŒ¸ New Commit to \${branch}: \${commitMessage}\`;
            message = \`
              <h2>New Commit to \${repo}</h2>
              <p><strong>Branch:</strong> \${branch}</p>
              <p><strong>Commit:</strong> \${commitMessage}</p>
              <p><strong>By:</strong> \${actor}</p>
              <p><a href=\"\${commitUrl}\" style=\"background:#FF69B4;color:#fff;padding:10px 20px;text-decoration:none;\">View Commit</a></p>
              <hr>
              <p style=\"color:#666;\">Part of The Pink Revolution ðŸ’–</p>
            \`;
          }

          const mailOptions = {
            from: process.env.EMAIL_USER,
            to: process.env.RECIPIENT_EMAIL,
            subject: subject,
            html: message
          };

          transporter.sendMail(mailOptions, (error, info) => {
            if (error) {
              console.log('Error:', error);
              process.exit(1);
            } else {
              console.log('Email sent:', info.response);
            }
          });
          "
